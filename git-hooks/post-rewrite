#!/bin/sh
# Restore fork-specific CLAUDE.md after rebase (upstream tracks it as a symlink to AGENTS.md).
BACKUP="/data/Code/openclaw.CLAUDE.md"
TARGET="CLAUDE.md"

if [ "$1" = "rebase" ] && [ -f "$BACKUP" ]; then
  if [ -L "$TARGET" ] || ! diff -q "$BACKUP" "$TARGET" >/dev/null 2>&1; then
    rm -f "$TARGET"
    cp "$BACKUP" "$TARGET"
    git rm --cached "$TARGET" 2>/dev/null || true
    echo "post-rewrite: restored fork CLAUDE.md from backup"
  fi
fi
